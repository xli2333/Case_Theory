# Render 部署操作指南（小白版）

> 建议用 UTF-8 编码保存本文件，避免中文显示异常。

## 1. 需要准备什么
- 一个 GitHub 仓库（你自己创建即可）。
- 在本机安装好 Git（可选，本地推送用）。
- 一个 Render 账号（免费版可用，但首次拉模型可能较慢）。

## 2. 目录放哪里
- 将整个 `render_deploy` 文件夹视作项目根目录上传到 GitHub。
- 不需要上传其他同级文件，保持仓库根目录有 `render.yaml`、`requirements.txt`、`src`、`data`、`font` 等。

## 3. 本地快速检查（可选）
1) 安装依赖：`pip install -r requirements.txt`
2) 启动 API：`uvicorn src.api.main:app --host 0.0.0.0 --port 8000`
3) 启动前端（新窗口）：`API_URL=http://127.0.0.1:8000 streamlit run src/web/app.py --server.address 0.0.0.0 --server.port 8501`
4) 浏览器访问 `http://127.0.0.1:8501` 确认页面能加载。

## 4. 推送到 GitHub
1) 进入 `render_deploy` 目录。
2) `git init`（若新仓库）  
3) `git add . && git commit -m "init render deploy"`
4) 关联远程：`git remote add origin <你的仓库地址>`
5) 推送：`git push -u origin main`（或者 master，依仓库默认分支而定）。

## 5. Render 部署（Blueprint 方式）
1) 登录 Render，选择 **New +** → **Blueprint**。
2) 选中你的 GitHub 仓库；框架根目录保留默认（仓库根即 `render_deploy`）。
3) Render 会自动读取 `render.yaml`，生成两个服务：
   - `casecheck-api`（FastAPI 后端）
   - `casecheck-web`（Streamlit 前端）
4) 规格选择：至少 Starter（内存更稳，首轮下载模型更快）。
5) 点击部署，等待后端先启动。首轮会下载 BGE-M3 模型（约 2GB），可能耗时 5–10 分钟。

## 6. 环境变量要点
- 前端 `casecheck-web`：`API_URL` 必须指向后端公网地址。例如 Render 默认可能是 `https://<你的 api 服务名>.onrender.com`。如果地址不同，部署后到该服务的 Environment 页面修改 `API_URL`，重新 Deploy。
- 后端 `casecheck-api`：`DATABASE_PATH`、`VECTOR_DB_PATH`、`HF_HOME`、`TRANSFORMERS_CACHE` 等已在 `render.yaml` 里预设；如需改动可在 Render 控制台调整。
- 模型缓存：`casecheck-api` 已挂载持久盘 `/opt/render/project/src/data/models`，首次下载后会复用。

## 7. 验证上线
- 后端健康检查：访问 `https://<后端域名>/health` 应返回 JSON（含 status/healthy）。
- 前端访问：`https://<前端域名>/` 能看到页面；若提示无法连接 API，检查 `API_URL` 是否填了正确后端地址。

## 8. 常见问题
- **页面提示 API Unreachable**：确认 `API_URL` 环境变量；后端是否已启动成功（看 Render Logs）；等待模型下载完成后再试。
- **部署超时/内存不足**：提升到更高配或增加启动超时时间（Render 高配方案更稳）。
- **中文乱码**：保持文件 UTF-8 编码；浏览器嫌疑较小。

## 9. 目录简述
- `render.yaml`：Render 蓝图，定义前后端两个 Web 服务。
- `requirements.txt`：Python 依赖（含 `python-multipart` 处理上传）。
- `src/api`：FastAPI 入口 `src/api/main.py`。
- `src/web`：Streamlit 入口 `src/web/app.py`。
- `data/database`：初始 `cases.db` 与向量库。  
- `data/models`：模型缓存目录（已放 `.gitkeep`，运行时会下载）。  
- `font/`：字体文件，供 PDF 导出用。

照着以上步骤操作，即使是初学者也能把项目顺利部署到 Render。若部署后要改站点名或域名，记得同步更新前端服务的 `API_URL`。祝顺利！***
