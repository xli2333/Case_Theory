services:
  - type: web
    name: casecheck-app
    env: python
    plan: starter
    pythonVersion: 3.10
    buildCommand: pip install -r requirements.txt
    # 使用混合启动脚本同时运行前后端
    startCommand: bash start_combined.sh
    healthCheckPath: /health
    envVars:
      - key: PYTHONPATH
        value: /opt/render/project/src
      - key: HF_HOME
        value: /opt/render/project/src/data/models
      - key: TRANSFORMERS_CACHE
        value: /opt/render/project/src/data/models
      - key: DATABASE_PATH
        value: data/database/cases.db
      - key: VECTOR_DB_PATH
        value: data/database/vectors
      - key: LOG_FILE
        value: data/logs/api.log
      - key: DEVICE
        value: cpu
      # 这里不需要 API_URL，因为脚本里已经强制设为 localhost 了
    disk:
      name: casecheck-model-cache
      mountPath: /opt/render/project/src/data/models
      sizeGB: 6
